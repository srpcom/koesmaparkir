<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulir Layanan Parkir</title>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/srpcom/koesmaparkir/main/new%20logo%20rsud%202025%20kecil.png">
    <style>
        :root {
            --primary-color: #005A9C; --secondary-color: #F0F8FF; --border-color: #DCDCDC;
            --text-color: #333; --success-color: #28a745; --error-color: #dc3545;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        body {
            font-family: var(--font-family); background-image: url('https://raw.githubusercontent.com/srpcom/koesmaparkir/main/foto%20ipit.jpg');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: var(--text-color); margin: 0; padding: 10px;
        }
        .container { max-width: 800px; width: 100%; margin: 20px auto; background-color: rgba(255, 255, 255, 0.4); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-radius: 12px; box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); }
        header { background-color: var(--primary-color); color: white; padding: 20px; text-align: center; border-bottom: 5px solid #00487a; position: sticky; top: 0; z-index: 100; }
        header .logo-image { width: 70px; height: auto; margin: 0 auto 15px auto; display: block; }
        header h1 { margin: 0; font-size: 1.5em; font-weight: 700; }
        header p { margin: 5px 0 0; opacity: 0.9; font-size: 0.9em; }
        form { padding: 20px; }
        fieldset { border: 1px solid transparent; border-radius: 8px; padding: 20px 15px; margin-bottom: 25px; }
        legend { font-weight: bold; font-size: 1.2em; color: #fff; padding: 8px 16px; border-radius: 20px; background-color: rgba(0, 90, 156, 0.7); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        input[type="text"], input[type="tel"], input[type="password"], select, textarea, input[type="file"] { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 6px; box-sizing: border-box; font-size: 16px; background-color: rgba(255, 255, 255, 0.8); }
        button { width: 100%; padding: 15px; background-color: var(--primary-color); color: white; border: none; border-radius: 6px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: background-color 0.3s; }
        button:hover:not(:disabled) { background-color: #00487a; }
        button:disabled { background-color: #a0a0a0; cursor: not-allowed; }
        .hidden { display: none !important; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); z-index: 1000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .spinner { border: 8px solid #f3f3f3; border-top: 8px solid var(--primary-color); border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal-container { background-color: white; color: var(--text-color); padding: 25px; border-radius: 12px; max-width: 500px; width: 90%; box-shadow: 0 5px 25px rgba(0,0,0,0.2); }
        .modal-buttons { display: flex; gap: 15px; margin-top: 25px; }

        #admin-panel { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(10px); justify-content: center; align-items: center; z-index: 2000; }
        .admin-box { background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .admin-box h2 { text-align: center; color: var(--primary-color); margin-top: 0; }
        #admin-error { color: var(--error-color); text-align: center; margin-bottom: 15px; font-size: 0.9em; }
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(26px); }
        .dashboard-item { display: flex; justify-content: space-between; align-items: center; }
        #maintenance-status span.active { color: var(--success-color); }
        #maintenance-status span.inactive { color: var(--error-color); }

        #maintenance-content {
            display: none; flex-direction: column; justify-content: center; align-items: center; height: 100vh;
            text-align: center; padding: 20px; box-sizing: border-box; background-color: #f8f9fa;
        }
        #maintenance-content .logo { width: 100px; margin-bottom: 30px; }
        #maintenance-content h1 { font-size: 2.5em; margin: 0; color: #005A9C; }
        #maintenance-content p { font-size: 1.2em; color: #6c757d; line-height: 1.6; }
        #maintenance-content .maintenance-icon { font-size: 5em; color: #005A9C; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div id="maintenance-content">
        <img src="https://raw.githubusercontent.com/srpcom/koesmaparkir/main/new%20logo%20rsud%202025%20kecil.png" alt="Logo RSUD" class="logo">
        <div class="maintenance-icon">&#9881;</div>
        <h1>Sedang dalam Perbaikan</h1>
        <p>Mohon maaf, halaman ini sedang dalam pemeliharaan. Kami akan segera kembali.</p>
    </div>
    
    <div id="main-content">
        <div id="loading-overlay" class="overlay" style="color:white; flex-direction:column;"> <div class="spinner"></div> <p>Mengirim data, mohon tunggu...</p> </div>
        <div id="confirmation-overlay" class="overlay"> <div class="modal-container"> <h2>Konfirmasi Data Anda</h2> <p>Mohon periksa kembali data Anda.</p> <div id="summary-content"></div> <div class="modal-buttons"> <button type="button" id="edit-button">Perbaiki</button> <button type="button" id="final-submit-button">Ya, Kirim</button> </div> </div> </div>
        <div id="notification-modal" class="overlay"> <div class="modal-container" style="text-align:center;"> <p id="notification-icon" style="font-size:50px; line-height:1;"></p> <h2 id="notification-title"></h2> <p id="notification-message"></p> <div class="modal-buttons"> <button type="button" id="notification-close-button">Tutup</button> </div> </div> </div>
        <div class="container">
             <header id="main-header">
                <img src="https://raw.githubusercontent.com/srpcom/koesmaparkir/main/new%20logo%20rsud%202025%20kecil.png" alt="Logo RSUD" class="logo-image">
                <h1>FORMULIR LAYANAN PARKIR</h1>
                <p>RSUD dr. R. KOESMA TUBAN</p>
            </header>
            <form id="parkingForm">
                 <fieldset> <legend>Tujuan Pengisian</legend> <div class="form-group"> <label><input type="radio" name="jenisPengajuan" value="Pendaftaran Baru" onchange="toggleSections()" required> Daftar Baru</label> <label><input type="radio" name="jenisPengajuan" value="Rubah Nomor Kendaraan" onchange="toggleSections()" required> Rubah Nopol</label> <label><input type="radio" name="jenisPengajuan" value="Hapus Nomor Kendaraan" onchange="toggleSections()" required> Hapus Kendaraan</label> <label><input type="radio" name="jenisPengajuan" value="Tambah Kendaraan Baru" onchange="toggleSections()" required> Tambah Kendaraan</label> <label><input type="radio" name="jenisPengajuan" value="Penggantian Kartu" onchange="toggleSections()" required> Ganti Kartu</label> <label><input type="radio" name="jenisPengajuan" value="Lainnya" onchange="toggleSections()" required> Lainnya</label> </div> </fieldset>
                 <fieldset> <legend>Informasi Karyawan</legend> <div class="form-group"><label for="namaLengkap">Nama Lengkap</label><input type="text" id="namaLengkap" name="namaLengkap" required></div> <div class="form-group"><label for="unitKerja">Unit / Bagian Kerja</label><select id="unitKerja" name="unitKerja" required onchange="handleUnitKerjaChange(this)"><option value="">-- Pilih Unit --</option></select></div> <div class="form-group hidden" id="unitKerjaLainnya-group"><label for="unitKerjaLainnya">Tulis Nama Unit Anda</label><input type="text" id="unitKerjaLainnya" name="unitKerjaLainnya"></div> <div class="form-group"><label for="telepon">Nomor Telepon / WA (Aktif)</label><input type="tel" id="telepon" name="telepon" required></div> <div class="form-group"><label for="fileKtp">Upload Identitas (KTP/SIM)</label><input type="file" id="fileKtp" name="fileKtp" accept=".jpg,.jpeg,.png,.pdf" required></div> </fieldset>
                 <fieldset id="update-section" class="hidden"><legend>Data Kendaraan Lama</legend><div class="form-group"><label>Jenis Kendaraan Lama</label><br><label><input type="radio" name="jenisKendaraanLama" value="Mobil"> Mobil</label><label><input type="radio" name="jenisKendaraanLama" value="Sepeda Motor"> Motor</label></div><div class="form-group"><label for="noPolisiLama">Nomor Polisi Lama</label><input type="text" id="noPolisiLama" name="noPolisiLama" oninput="this.value = this.value.toUpperCase().replace(/\s/g, '')"></div></fieldset>
                 <fieldset id="card-replacement-section" class="hidden"><legend>Info Penggantian Kartu</legend><div class="form-group"><label for="alasanPenggantian">Alasan Penggantian</label><textarea id="alasanPenggantian" name="alasanPenggantian" rows="3"></textarea></div></fieldset>
                 <fieldset id="new-vehicle-section" class="hidden"><legend>Detail Kendaraan Baru</legend><div class="form-group"><label><input type="radio" name="jenisKendaraan" value="Mobil"> Mobil</label><label><input type="radio" name="jenisKendaraan" value="Sepeda Motor"> Motor</label></div><div class="form-group"><label for="noPolisiBaru">Nomor Polisi Baru</label><input type="text" id="noPolisiBaru" name="noPolisiBaru" oninput="this.value = this.value.toUpperCase().replace(/\s/g, '')"><p style="font-size:0.8em; color:#666;">Gunakan huruf besar, tanpa spasi. Misal: S4966EP</p></div></fieldset>
                 <fieldset id="lainnya-section" class="hidden"><legend>Keterangan Lainnya</legend><div class="form-group"><label for="keteranganLainnya">Tulis keterangan lengkap Anda</label><textarea id="keteranganLainnya" name="keteranganLainnya" rows="5"></textarea></div></fieldset>
                 <fieldset id="agreement-section" class="hidden"><legend>Persetujuan</legend><div class="form-group" style="display: flex; align-items: flex-start;"><input type="checkbox" id="agreement" name="agreement" required style="margin-top:5px; margin-right:10px;"><label for="agreement">Saya menyatakan data yang saya isikan adalah benar dan bersedia mematuhi peraturan parkir yang berlaku.</label></div></fieldset>
                 <button type="submit" id="submit-button">Kirim Formulir</button>
            </form>
        </div>
    </div>

    <div id="admin-panel">
        <div id="admin-login" class="admin-box">
            <h2>Login Administrator</h2>
            <p id="admin-error" class="hidden"></p>
            <div class="form-group">
                <label for="admin-password">Password</label>
                <input type="password" id="admin-password" placeholder="Masukkan password admin">
            </div>
            <button id="admin-login-button">Login</button>
        </div>
        <div id="admin-dashboard" class="admin-box hidden">
            <h2>Dasbor Admin</h2>
            <div class="dashboard-item">
                <div>
                    <p style="margin: 0; font-weight: 600;">Mode Maintenance</p>
                    <p id="maintenance-status" style="margin: 5px 0 0; font-weight: bold;">Status: </p>
                </div>
                <label class="switch">
                    <input type="checkbox" id="maintenance-toggle">
                    <span class="slider"></span>
                </label>
            </div>
             <p style="font-size: 0.8em; color: #666; margin-top: 20px;">Jika diaktifkan, pengunjung akan melihat halaman perbaikan.</p>
             <button id="admin-logout-button" style="background-color: #6c757d; margin-top: 15px;">Logout</button>
        </div>
    </div>

    <script>
        const webAppUrl = 'https://script.google.com/macros/s/AKfycbyyGFR-VxH8DWoTu7PlPjDCkp7d-QkmrC6vzxlU36WfWOxZgOKUItV0SppH0OcoCB4/exec';
        
        const mainContent = document.getElementById('main-content');
        const maintenanceContent = document.getElementById('maintenance-content');
        const adminPanel = document.getElementById('admin-panel');

        function showContent(mode) {
             // Sembunyikan semua container utama terlebih dahulu
             mainContent.style.display = 'none';
             maintenanceContent.style.display = 'none';
             adminPanel.style.display = 'none';

             // Tampilkan container yang sesuai
             switch(mode) {
                case 'admin':
                    adminPanel.style.display = 'flex';
                    initializeAdminPanel();
                    break;
                case 'maintenance':
                    maintenanceContent.style.display = 'flex';
                    break;
                case 'form':
                    mainContent.style.display = 'block';
                    initializeForm();
                    break;
                case 'error':
                    maintenanceContent.style.display = 'flex';
                    document.querySelector('#maintenance-content h1').textContent = 'Gagal Memuat';
                    document.querySelector('#maintenance-content p').textContent = 'Tidak dapat terhubung ke server. Coba lagi nanti.';
                    break;
             }
        }

        window.addEventListener('load', async () => {
            // Logika utama untuk menentukan konten apa yang ditampilkan saat halaman dimuat
            if (window.location.hash === '#admin') {
                showContent('admin');
                return; // Hentikan eksekusi lebih lanjut jika ini adalah halaman admin
            }
            
            // Jika bukan halaman admin, ambil status dari server
            try {
                const response = await fetch(webAppUrl + '?action=getStatus');
                if (!response.ok) throw new Error('Network response error');
                const data = await response.json();
                if (data.status === 'success') {
                    showContent(data.maintenanceMode ? 'maintenance' : 'form');
                } else {
                    showContent('error');
                }
            } catch (error) {
                console.error('Fetch status failed:', error);
                showContent('error');
            }
        });
        
        function initializeAdminPanel() {
            if (adminPanel._initialized) return;
            adminPanel._initialized = true;

            const loginView = document.getElementById('admin-login');
            const dashboardView = document.getElementById('admin-dashboard');
            const passwordInput = document.getElementById('admin-password');
            const loginButton = document.getElementById('admin-login-button');
            const errorMsg = document.getElementById('admin-error');
            const toggle = document.getElementById('maintenance-toggle');
            const statusText = document.getElementById('maintenance-status');
            const logoutButton = document.getElementById('admin-logout-button');
            let sessionPassword = null;

            async function callApi(action, data = {}) {
                loginButton.disabled = true;
                try {
                    const response = await fetch(webAppUrl, {
                        method: 'POST', mode: 'cors', cache: 'no-cache',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action, ...data }),
                    });
                    if (!response.ok) throw new Error(`Server error: ${response.statusText}`);
                    return await response.json();
                } catch (err) {
                    console.error('API call failed:', err);
                    return { status: 'error', message: 'Tidak dapat terhubung ke server.' };
                } finally {
                    loginButton.disabled = false;
                }
            }

            async function login() {
                const password = passwordInput.value;
                if (!password) { showError('Password tidak boleh kosong.'); return; }
                loginButton.textContent = 'Mengecek...';
                errorMsg.classList.add('hidden');
                
                const result = await callApi('getMaintenanceStatus', { password });
                
                if (result.status === 'success') {
                    sessionPassword = password;
                    loginView.classList.add('hidden');
                    dashboardView.classList.remove('hidden');
                    updateDashboard(result.data.isEnabled);
                } else {
                    showError(result.message || 'Password salah.');
                }
                loginButton.textContent = 'Login';
            }

            function logout() {
                sessionPassword = null; passwordInput.value = '';
                dashboardView.classList.add('hidden'); loginView.classList.remove('hidden');
            }

            async function setMode(isEnabled) {
                const result = await callApi('setMaintenanceMode', { password: sessionPassword, enabled: isEnabled });
                if (result.status === 'success') {
                    updateDashboard(isEnabled);
                } else {
                    alert('Gagal mengubah status: ' + (result.message || 'Error'));
                    toggle.checked = !isEnabled; // Kembalikan jika gagal
                }
            }
            
            function showError(message) {
                errorMsg.textContent = message;
                errorMsg.classList.remove('hidden');
            }

            function updateDashboard(isEnabled) {
                toggle.checked = isEnabled;
                statusText.innerHTML = `Status: ${isEnabled ? '<span class="active">AKTIF</span>' : '<span class="inactive">NONAKTIF</span>'}`;
            }

            loginButton.addEventListener('click', login);
            passwordInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') login(); });
            toggle.addEventListener('change', (e) => setMode(e.target.checked));
            logoutButton.addEventListener('click', logout);
        }

        function initializeForm() {
            if (mainContent._initialized) return;
            mainContent._initialized = true;

            let formDataObject = {};
            const allSections = {
                update: document.getElementById('update-section'),
                cardReplacement: document.getElementById('card-replacement-section'),
                newVehicle: document.getElementById('new-vehicle-section'),
                lainnya: document.getElementById('lainnya-section'),
                agreement: document.getElementById('agreement-section')
            };
            const loadingOverlay = document.getElementById('loading-overlay');
            const confirmOverlay = document.getElementById('confirmation-overlay');
            const notifModal = document.getElementById('notification-modal');
            
            const unitKerjaSelect = document.getElementById('unitKerja');
            if (unitKerjaSelect.options.length <= 1) {
                const units = ["INSTALASI FARMASI", "INSTALASI RADIOLOGI", "INSTALASI BEDAH SENTRAL", "INSTALASI GAWAT DARURAT", "ICU", "ICCU", "HCU", "INSTALASI LABORATORIUM", "INSTALASI HEMODIALISA", "INSTALASI GIZI", "INSTALASI REKAM MEDIK", "INSTALASI PEMELIHARAAN SARANA", "INSTALASI PENYEHATAN LINGKUNGAN", "INSTALASI FORENSIK DAN MEDIKOLEGAL", "INSTALASI DIAGNOSTIK DAN INTERVENSI KORDIOVASKULER", "INSTALASI MATERNAL DAN PERINATAL", "INSTALASI REHABILITASI MEDIK", "INSTALASI SIM RS", "INSTALASI PKRS", "POLI KIR", "POLI EKSKUTIF", "POLI TMS", "POLI EEG", "POLI ENDOSKOPI", "POLI ESWL", "RUANG MAWAR/ASTER", "RUANG ANYELIR/MELATI", "RUANG ANGGREK/DAHLIA", "RUANG BOUGENVILLE", "RUANG PAVILIUN", "RUANG ISOLASI", "RUANG PERINATOLOGI", "POLI ANAK", "POLI PENYAKIT DALAM", "POLI BEDAH", "POLI MATA", "POLI THT", "POLI SYARAF", "POLI JANTUNG", "POLI PARU", "POLI GIGI", "POLI KULIT DAN KELAMIN", "POLI JIWA", "POLI TB", "POLI VCT", "POLI UMUM", "BAGIAN PROGPEL", "BAGIAN KEUANGAN", "BAGIAN ADMINISTRASI DAN UMUM DAN SDM", "BIDANG PELAYANAN MEDIK", "BIDANG KEPERAWatan", "BIDANG PELAYANAN PENUNJANG", "KOMITE MEDIK", "KOMITE KEPERAWATAN", "KOMITE PPI", "KOMITE KESEHATAN DAN KESELAMATAN KERJA", "SATUAN PEMERIKSAAN INTERNAL", "Lainnya"];
                units.forEach(u => { const o = document.createElement('option'); o.value = o.textContent = u; unitKerjaSelect.appendChild(o); });
            }

            window.toggleSections = function() {
                const choice = document.querySelector('input[name="jenisPengajuan"]:checked').value;
                Object.values(allSections).forEach(sec => sec.classList.add('hidden'));
                const show = (sec) => sec.classList.remove('hidden');
                switch(choice) {
                    case 'Pendaftaran Baru': case 'Tambah Kendaraan Baru': show(allSections.newVehicle); show(allSections.agreement); break;
                    case 'Rubah Nomor Kendaraan': show(allSections.update); show(allSections.newVehicle); show(allSections.agreement); break;
                    case 'Hapus Nomor Kendaraan': show(allSections.update); show(allSections.agreement); break;
                    case 'Penggantian Kartu': show(allSections.update); show(allSections.cardReplacement); show(allSections.agreement); break;
                    case 'Lainnya': show(allSections.lainnya); show(allSections.agreement); break;
                }
            };

            window.handleUnitKerjaChange = function(select) {
                const lainnya = document.getElementById('unitKerjaLainnya-group');
                lainnya.classList.toggle('hidden', select.value !== 'Lainnya');
                document.getElementById('unitKerjaLainnya').required = (select.value === 'Lainnya');
            };

            function populateSummary(data) {
                const content = document.getElementById('summary-content');
                content.innerHTML = '';
                const add = (label, value) => { if (value) content.innerHTML += `<p><strong>${label}:</strong> ${value}</p>`; };
                add('Tujuan', data.jenisPengajuan);
                add('Nama Lengkap', data.namaLengkap);
                add('Unit Kerja', data.unitKerja === 'Lainnya' ? data.unitKerjaLainnya : data.unitKerja);
                add('No. Telepon', data.telepon);
                add('File Identitas', document.getElementById('fileKtp').files[0]?.name);
                add('Jenis Kend. Lama', data.jenisKendaraanLama);
                add('Nopol Lama', data.noPolisiLama);
                add('Jenis Kend. Baru', data.jenisKendaraan);
                add('Nopol Baru', data.noPolisiBaru);
                add('Alasan Ganti Kartu', data.alasanPenggantian);
                add('Keterangan Lainnya', data.keteranganLainnya);
            }
            
            function showNotification(isSuccess, message) {
                notifModal.querySelector('#notification-icon').textContent = isSuccess ? '✓' : '✗';
                notifModal.querySelector('#notification-icon').style.color = isSuccess ? 'var(--success-color)' : 'var(--error-color)';
                notifModal.querySelector('#notification-title').textContent = isSuccess ? 'Berhasil' : 'Gagal';
                notifModal.querySelector('#notification-message').textContent = message;
                notifModal.style.display = 'flex';
                notifModal.classList.toggle('success', isSuccess);
            }

            document.getElementById('parkingForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                formDataObject = Object.fromEntries(formData.entries());
                populateSummary(formDataObject);
                confirmOverlay.style.display = 'flex';
            });
            
            document.getElementById('edit-button').addEventListener('click', () => confirmOverlay.style.display = 'none');
            document.getElementById('notification-close-button').addEventListener('click', () => { if (notifModal.classList.contains('success')) window.location.reload(); else notifModal.style.display = 'none'; });
            
            document.getElementById('final-submit-button').addEventListener('click', async function() {
                confirmOverlay.style.display = 'none';
                loadingOverlay.style.display = 'flex';
                let dataToSubmit = { ...formDataObject };
                if (dataToSubmit.unitKerja === 'Lainnya') { dataToSubmit.unitKerja = dataToSubmit.unitKerjaLainnya; }
                delete dataToSubmit.unitKerjaLainnya;
                
                try {
                    const fileInput = document.getElementById('fileKtp').files[0];
                    if (fileInput) { dataToSubmit.fileKtp = await new Promise((resolve, reject) => { const reader = new FileReader(); reader.onloadend = () => resolve({ base64: reader.result.split(',')[1], type: fileInput.type, name: fileInput.name }); reader.onerror = reject; reader.readAsDataURL(fileInput); }); }
                    
                    const response = await fetch(webAppUrl, { method: 'POST', body: JSON.stringify(dataToSubmit) });
                    if (!response.ok) throw new Error("Gagal mengirim, respons server tidak valid.");
                    const result = await response.json();

                    if (result.status === 'sukses') {
                        showNotification(true, `Pengajuan Anda telah berhasil dikirim.`);
                    } else {
                        throw new Error(result.message || 'Terjadi kesalahan yang tidak diketahui.');
                    }
                } catch (error) {
                    showNotification(false, `Gagal mengirim data: ${error.message}`);
                } finally {
                    loadingOverlay.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>

